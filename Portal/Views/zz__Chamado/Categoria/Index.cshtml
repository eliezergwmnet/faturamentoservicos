@model List<Portal.BE.Chamado.CategoriaBE>


<div class="col-12">
    <div class="col-sm-3">
        <button class="btn btn-info" id="adicionaritens" style="margin-top:20px; margin-bottom: 20px" type="button"><i class="fa fa-search"></i> Adicionar</button>
    </div>
</div>



@{
    WebGrid objWebGrid = new WebGrid(Model, rowsPerPage: 30, canPage: true);
}
@objWebGrid.GetHtml(
tableStyle: "table table-striped table-bordered",
footerStyle: "Grid-Footer",
mode: WebGridPagerModes.All,
firstText: "Primeiro",
previousText: "Anterior",
nextText: "Proximo",
lastText: "Ultimo",
columns:
    objWebGrid.Columns
    (
        objWebGrid.Column(columnName: "cCa_id", header: "ID"),
        objWebGrid.Column(columnName: "cCa_nome", header: "Descrição"),
        objWebGrid.Column(columnName: "cCa_data", header: "Data"),
        objWebGrid.Column(format:@<text>
            <div class="text-right" style="width:55px"><a href="javascript:" style="padding: 0px 18px !important;" class="btn btn-info btn-sm editarconfiguracao" name="@item.cCa_nome" id="@item.cCa_id"><i class="fa fa-refresh"></i>&nbsp;Alterar</a></div>
        </text>),
        objWebGrid.Column(format:@<text>
            <div class="text-right" style="width:55px"><button type="button" style="padding: 0px 18px !important;" class="btn btn-danger btn-sm deletarconfiguracao" name="@item.cCa_nome" id="@item.cCa_id"><i class="fa fa-trash-o"></i>&nbsp;Delete</button></div>
        </text>)
    )

)


<script>
    $(function () {
        $("#adicionaritens").click(function () {
            AbreFormulario('', "Adicionar Prioridade", "");
        })

        $(".editarconfiguracao").click(function () {
            var nome = $(this).attr('name');
            var id = $(this).attr('id');

            AbreFormulario(id, "Alterar Prioridade", nome);
        });

        $(".deletarconfiguracao").click(function () {
            var id = $(this).attr('id');
            var name = $(this).attr('name');
            Confirmacao("Atenção", "Tem certeza que quer remover o item " + name, function (retorno) {
                if (retorno){
                    $.ajax({
                        url: '/Chamado/Categoria/Delete',
                        data: { cPr_id: id },
                        type: 'POST',
                        beforeSend: function () {
                        },
                        success: function (retornoEndereco) {
                            Alerta("Delete efetuado com sucesso", function () {
                                window.location = "/Chamado/Categoria";
                            })
                        },
                        complete: function () {
                        }
                    });
                }
                else
                    Alerta('Cancelado', 'Operação cancelada', function () { });
            })
        })
    })

    function AbreFormulario(id, titulo, valor) {
        

        $.confirm({
            title: titulo,
            content: '' +
            '<form action="" class="formName">' +
            //'<div class="form-group">' +
            //'<label>Categoria</label>' +
            //'<select id="categoria" class="categoria form-control" ></select>' +
            //'</div>' +
            '<div class="form-group">' +
            '<label>Descrição</label>' +
            '<input type="text" placeholder="Descrição" id="descricao" class="descricao form-control" value="' + valor + '" required />' +
            '</div>' +
            '</form>',
            buttons: {
                formSubmit: {
                    text: 'Enviar',
                    btnClass: 'btn-blue',
                    action: function () {
                        var categoria = this.$content.find('.categoria').val();
                        var descricao = this.$content.find('.descricao').val();
                        if (!descricao) {
                            $.alert('Campo Descrição obrigatório');
                            return false;
                        }
                        $.ajax({
                            url: '/Chamado/Categoria/Insert',
                            data: { cCa_nome: descricao, cCa_id: id, cCa_categoria: 0 },
                            type: 'POST',
                            beforeSend: function () {
                            },
                            success: function (retornoEndereco) {
                                Alerta("Alteração efetuado com sucesso", function () {
                                    window.location = "/Chamado/Categoria";
                                })
                            },
                            complete: function () {
                            }
                        });
                    }
                },
                Cancelar: function () {
                },
            },
            onContentReady: function () {
                var jc = this;
                CarregarSelect("categoria", "CarregaChamadoCategoria");

                this.$content.find('form').on('submit', function (e) {
                    e.preventDefault();
                    jc.$$formSubmit.trigger('click');
                });
            }
        });
    }
</script>
