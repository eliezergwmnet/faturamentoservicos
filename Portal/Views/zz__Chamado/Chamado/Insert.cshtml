@{ 
    Portal.Helper.Common.NumChamado();
    var idItem  = ViewBag.ID;
}

<style>
    #dropArea {
        background: #b5b5b5;
        border: black dashed 1px;
        height: 150px;
        text-align: center;
        color: #fff;
        padding-top: 12px;
    }

    .active-drop {
        background: #77bafa !important;
        border: solid 2px blue !important;
        opacity: .5;
        color: black !important;
    }
</style>

<div class="row">
    <div class="col-lg-12">
        <div class="card">

            <div class="card-body">
                <div id="pay-invoice">
                    <div class="card-body">
                        <form action="" id="abrirchamado" method="post" name="enviar">
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label for="cOs_numero" class="control-label mb-1">Numero Ticket</label>
                                    <input id="cOs_numero" name="cOs_numero" type="text" placeholder="Razão Social" class="form-control obrigatorio" value="@idItem" readonly>
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label for="cli_id" class="control-label mb-1">Cliente</label>
                                    <select id="cli_id" name="cli_id" class="form-control" data-placeholder="Selecionar Cliente" tabindex="1" required></select>
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label for="cPr_id" class="control-label mb-1">Prioridade</label>
                                    <select id="cPr_id" name="cPr_id" class="form-control obrigatorio" required></select>
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <div class="form-group">
                                    <label for="cCa_id" class="control-label mb-1">Categoria</label>
                                    <select id="cCa_id" name="cCa_id" class="form-control obrigatorio" required></select>
                                </div>
                            </div>


                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label for="cOs_titulo" class="control-label mb-1">Titulo</label>
                                    <input id="cOs_titulo" name="cOs_titulo" type="text" placeholder="Titulo" class="form-control obrigatorio" required>
                                </div>
                            </div>
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label for="cOsMes_mensagem" class="control-label mb-1">Mensagem</label>
                                    <textarea id="cOsMes_mensagem" rows="6" name="cOsMes_mensagem" placeholder="Mensagem" class="form-control obrigatorio" ></textarea>
                                </div>
                            </div>
                            <div class="col-sm-12">
                                    <div class="form-group">
                                        <!--<label for="cOsAr_arquivo" class="control-label mb-1">Enviar Arquivo</label>
                                        <input id="cOsAr_arquivo" name="cOsAr_arquivo" type="file" placeholder="Enviar Arquivo" class="form-control obrigatorio" required>
                                            -->

                                        <div id="dropArea">
                                            Arraste os arquivos aqui.
                                        </div>
                                        <h4>Arquivos enviados : </h4>
                                        <ul class="list-group" id="uploadList"></ul>
                                </div>
                            </div>


                            

                            <div class="col-sm-12">
                                <button type="button" id="enviardados" class="btn btn-primary btn-sm">
                                    <i class="fa fa-dot-circle-o"></i> Salvar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="@Url.Content("~/Content/js/fileDrop.js")"></script>
<script>

    var selectedFiles = [];;
 
   
    $(function () {
        CarregarSelect("cli_id", "CarregaClientes", null,
        function () {
            jQuery("#cli_id").chosen({
                disable_search_threshold: 10,
                no_results_text: "Cliente não encontrada!",
                width: "100%"
            });
        });
        CarregarSelect("cCa_id", "CarregaChamadoCategoria");
        CarregarSelect("cPr_id", "CarregaChamadoPrioridade");
        
        $('#enviardados').click(function () {
            var obj = { objArquivo: selectedFiles.join(','), cOs_numero: $("#cOs_numero").val(), cli_id: $("#cli_id").val(), cPr_id: $("#cPr_id").val(), cCa_id: $("#cCa_id").val(), cOs_titulo: $("#cOs_titulo").val(), cOsMes_mensagem: $("#cOsMes_mensagem").val() };
            $.ajax({
                type: "POST",
                url: "/Chamado/Ticket/SalvarDados",
                data: obj,
                data: obj,
                success: function (result) {
                    alert(result);
                },
                error: function () {
                    alert("There was error uploading files!");
                }
            });
            return false;
        });

        $('#dropArea').filedrop({
            url: '@Url.Action("UploadFiles")',
            allowedfiletypes: ['image/jpeg', 'image/png', 'image/gif'],
            allowedfileextensions: ['.jpg', '.jpeg', '.png', '.gif'],
            paramname: 'files',
            maxfiles: 15,
            maxfilesize: 5, // in MB
            dragOver: function () {
                $('#dropArea').addClass('active-drop');
            },
            dragLeave: function () {
                $('#dropArea').removeClass('active-drop');
            },
            drop: function () {
                $('#dropArea').removeClass('active-drop');
            },
            afterAll: function (e) {
                $('#dropArea').html('Arquivo Enviado com Sucesso!');
            },
            uploadFinished: function (i, file, response, time) {
                $('#uploadList').append('<li class="list-group-item">' + file.name + '</li>');
                selectedFiles.push(response);
            }
        })
    })
</script>